server {
  listen <%= node['backuppc']['cgi']['port'] %>;
  server_name <%= node['backuppc']['cgi']['servername'] %>;

  access_log <%= ::File.join(node['nginx']['log_dir'], 'backuppc.access_log') %>;
  error_log  <%= ::File.join(node['nginx']['log_dir'], 'backuppc.error_log') %>;


  location /backuppc {
    auth_basic "BackupPC admin";
    auth_basic_user_file <%= ::File.join(node['backuppc']['ConfDir'], 'htpasswd') %>;
    root <%= ::File.join(node['backuppc']['InstallDir'], 'cgi-bin') %>;
    index /index.cgi;
  }

  location  ~\.cgi$ {
    gzip off;
    include <%= ::File.join(node['nginx']['dir'], 'fastcgi_params') %>;
    fastcgi_pass <%= node['backuppc']['cgi']['socket'] %>;
    fastcgi_index BackupPC_Admin;
    fastcgi_param SCRIPT_FILENAME <%= ::File.join(node['backuppc']['InstallDir'], 'cgi-bin') %>$fastcgi_script_name;
  }
}
